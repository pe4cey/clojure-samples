<html>
<head>
    <title>Tooltips</title>
    <link type="text/css" rel="stylesheet" href="ex.css?3.2"/>
    <script src="js/protovis.js" type="text/javascript"></script>
    <script src="js/jquery.min.js" type="text/javascript"></script>
</head>
<body>
<div id="center">
    <div id="fig">
        <script type="text/javascript+protovis">
            function firstNonZeroElement(arr) {
                var value = 0;
                var counting = true;

                $.each(arr, function (index, element) {
                    if(counting && element != 0) {
                        value = index;
                        counting = false;
                    }
                });

                return value;
            }

            var dataURL = "/failed-builds-by-day.json";
            var jsonData = $.ajax({ type: "GET", url: dataURL, async: false }).responseText;
            var failedBuilds = JSON.parse(jsonData);

            var start = firstNonZeroElement(failedBuilds);
            var end = failedBuilds.length - firstNonZeroElement(failedBuilds.slice(0).reverse());

            var nonZeroElements = failedBuilds.slice(start, end);

            var data = nonZeroElements;
            console.log("Data: "+ data);
        </script>

        <script type="text/javascript+protovis">

            /* Sizing and scales. */
            var w = 1000,
            h = 500,
            x = pv.Scale.linear(0, 50).range(0, w),
            y = pv.Scale.ordinal(pv.range(start, end, 1)).splitBanded(0, h, 4/5);

            /* The root panel. */
            var vis = new pv.Panel()
            .def("i", -1)
            .width(w)
            .height(h)
            .bottom(20)
            .left(100)
            .right(40)
            .top(5);

            /* The bars. */
            var bar = vis.add(pv.Bar)
            .data(data)
            .top(function() y(start + this.index))
            .height(y.range().band)
            .left(0)
            .fillStyle(function() vis.i() == this.index ? "orange" : "red")
            .event("mouseover", function() vis.i(this.index))
            .event("mouseout", function() vis.i(-1))
            .width(x);

            /* The value label. */
            bar.anchor("right").add(pv.Label)
            .visible(function() vis.i() >= 0)
            .textStyle("white")
            .text(function(d) d.toFixed(1));

            /* The variable label. */
            bar.anchor("left").add(pv.Label)
            .textMargin(5)
            .textAlign("right")
            .text(function(d) {
                var curr = this.index + start
                return (curr + ":00") + "-" +((curr + 1) + ":00");
            });

            /* X-axis ticks. */
            vis.add(pv.Rule)
            .data(x.ticks(5))
            .left(x)
            .strokeStyle(function(d) d ? "rgba(255,255,255,.3)" : "#000")
            .add(pv.Rule)
            .bottom(0)
            .height(5)
            .strokeStyle("#000")
            .anchor("bottom").add(pv.Label)
            .text(x.tickFormat);

            vis.render();

        </script>
    </div>
</div>
</body>
</html>